---
import type { GetStaticPaths, GetStaticPathsResult } from "astro";
import { getCollection, type CollectionEntry } from "astro:content";
import parseFilepath from "@/utils/parseFilepath";

// SSG
// NB: refactor to utils if reused -- getStaticPathsForCollection(collectionName)
export async function getStaticPaths() {
  let paths: GetStaticPathsResult = [];

  for (const entry of await getCollection("projects")) {
    console.debug("[SSG] Processing entry:", entry.id);

    // entry.id is relative filepath -- see: https://docs.astro.build/en/reference/api-reference/#id
    let { slug, date } = parseFilepath(entry.id);
    entry.date = date;

    console.debug(
      `[SSG] Parsed ${entry.id} to slug: '${slug}' and date: ${date.toISOString()}`
    );

    paths.push({ params: { slug: slug }, props: { entry } });
  }
  return paths;
}

// template
type Props = {
  entry: CollectionEntry<"projects">;
};

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h1>{entry.data.title}</h1>
    <h2>{entry.date.toISOString()}</h2>
    <Content />
  </body>
</html>
